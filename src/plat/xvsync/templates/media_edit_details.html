{% extends "base.html" %}

{% block content %}

<script>
	
	$(document).ready(function() {
        //load table
       
        $('#mytab').children().first().addClass("active");
        $("#{{ mid_site_list.0.site_id}}").addClass("active");
        document.getElementById("mid_2").value={{mid_site_list.0.mid}};
        switch({{channel_id}})
        {
        	case 2002:
        	case 2003:
        		$("#{{ mid_site_list.0.site_id}}").load("{% url 'video_show_tv' %}", {"mid":'{{mid_site_list.0.mid}}' });
        		break;
        	case 2004:
        		$("#{{ mid_site_list.0.site_id}}").load("{% url 'video_show_variaty' %}", {"mid":'{{mid_site_list.0.mid}}' });
        		break;
        }
        
        $('form').submit(function () {
            //send request
            $.get($(this).attr('action'), $(this).serialize(), function(data) {
                var obj = JSON.parse(data);
                $('#tips').text('操作结果: ' +  obj.ret);
                location.reload();
            });
            return false;
        });
        
    });
        
	function showPg(xx,yy,zz){
    	$('#mytab a[href="#'+xx+'"]').tab('show'); // 显示点击的tab页面
    	$('#'+xx).html('<br>'+' 页面加载中，请稍后...'); // 设置页面加载时的显示内容
    	document.getElementById("mid_2").value=yy;
    	
    	if (zz=='2002' || zz=='2003')
	    	{
	    		$('#'+xx).load("{% url 'video_show_tv' %}", {"mid":yy });
	    	}
	    else if (zz=='2004')
	    	{
	    		$('#'+xx).load("{% url 'video_show_variaty' %}", {"mid":yy });
	    	}
	}
	
</script>

<div class="container-fluid">
	<div class="row-fluid">
		<div class="span12">
			<div class="row-fluid">
				<div class="span1"></div>
				<div class="span3">
					<img src="{{ posters_path }}{{ xv_detail.poster }}" width="270" height="400"/>
				</div>
				<div class="span7">
					<h3><a href="{{ xv_detail.url }}" target="_blank">{{ xv_detail.title }}</a></h3>
					<p>导演：{{ xv_detail.director|default_if_none:"(暂无)" }}</p>
					<p>演员：{{ xv_detail.actor|default_if_none:"(暂无)" }}</p>
					<p>地区：{{ xv_detail.district|default_if_none:"(暂无)" }}</p>
					<p>简介：{{ xv_detail.intro|default_if_none:"(暂无)" }}</p>
					<p>年份：{{ xv_detail.release_date|date:"Y-m-d"|default_if_none:"(暂无)" }}</p>
					<p>类型：{{ xv_detail.type|default_if_none:"(暂无)" }}</p>					
				</div>
				<div class="span1"></div>
			</div><br/>
			
			<div id="tips"></div>

			{% if channel_id == '2001' %}
				<div class="row-fluid">
					<div class="span1"></div>
					<div class="span6">
						<h4><b>
							播放源：<br><br>
							{% for mid_site in mid_site_list %}
								<table class="table table-striped table-bordered table-condensed">
									<tr>
										<form name="myForm" class="form-horizontal" role="form" action="/api/xvsync/del">
											{% csrf_token %}
											<td>
												<a href="{{ mid_site.url }}" target="_blank">
													<em>{{ mid_site.site }}</em>
												</a>
												<input type="hidden" id="mid_1" name="mid_1" value="{{ xv_detail.cid }}"/>
												<input type="hidden" id="mid_2" name="mid_2" value="{{ mid_site.mid }}"/>
												<input type="submit" value="删除" />
											</td>
										</form>
									</tr>
								</table>
							{% endfor %}
						</b></h4>
					</div>
					<div class="span5"></div>
				</div>
			{% endif %}
			
			{% if channel_id == '2002' or channel_id == '2004' or channel_id == '2003' %}
				<div class="row-fluid">
					<div class="span1"></div>
					<div class="span10">
						<div class="tabbable" id="tabs">
							<form action="/api/xvsync/del">
								<ul class="nav nav-tabs" id="mytab">
									{% for mid_site in mid_site_list %}
										<li>
											<a href="#{{ mid_site.site_id }}" onclick='showPg("{{ mid_site.site_id }}","{{ mid_site.mid }}","{{ channel_id }}")'>{{ mid_site.site }}
											</a>
										</li>
									{% endfor %}
								</ul>
								<input type="hidden" id="mid_1" name="mid_1" value="{{ xv_detail.cid }}"/>
								<input type="hidden" id="mid_2" name="mid_2" value=""/>
								<button id="submit" type="submit" class="btn btn-primary">删除</button>
							</form>									
							
							<div class="tab-content">
								{% for mid_site in mid_site_list %}
									<div class="tab-pane " id="{{ mid_site.site_id }}">
									</div>
								{% endfor %}
							</div>
						</div>
					</div>
					<div class="span1"></div>
				</div>
			{% endif %}
			
		</div>
	</div>
</div>



{% endblock %}