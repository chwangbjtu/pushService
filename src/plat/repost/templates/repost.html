{% extends "base.html" %}
{% load static %}

{% block content %}

<script>
    function parse_url()
    {
        document.getElementById("tip").innerHTML = "正在解析...";

        var para_url = document.getElementById('url').value;
        var url = "/api/parse?url=" + para_url;
        xmlHttp=GetXmlHttpObject();
        if (xmlHttp==null)
        {
            alert ("您的浏览器不支持AJAX！");
            return;
        }
        xmlHttp.onreadystatechange=stateChanged;
        xmlHttp.open("GET", url, true);
        xmlHttp.send(null);
    }

    function GetXmlHttpObject()
    {
      var xmlHttp=null;
      try
        {
        // Firefox, Opera 8.0+, Safari
        xmlHttp=new XMLHttpRequest();
        }
      catch (e)
        {
        // Internet Explorer
        try
          {
          xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
          }
        catch (e)
          {
          xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
          }
        }
      return xmlHttp;
    }

    function stateChanged()
    {
        if (xmlHttp.readyState==4)
        {
        //alert(xmlHttp.readyState);
            obj = JSON.parse(xmlHttp.responseText);

            if (obj.show_id)
            {
                document.getElementById("show_id").value= obj.show_id;
            }
            if (obj.site)
            {
                document.getElementById("site").value= obj.site;
            }
            if (obj.title)
            {
                document.getElementById("title").value= obj.title;
            }
            if (obj.tag)
            {
                document.getElementById("tags").value= obj.tag;
            }
            if (obj.description)
            {
                document.getElementById("desc").innerHTML = obj.description;
            }
            if (obj.msg)
            {
                document.getElementById("tip").innerHTML = obj.msg;
            }
        }
    }
</script>

<div class="container-fluid">
	<div class="row-fluid">
		<div class="span12">
			<div class="uploadTitle">
				<h3>转帖视频 - 支持优酷、YouTube、爱奇艺、酷6、56</h3>
	        </div><br/>
			<div class="tabbable" id="tabs">
				<ul class="nav nav-tabs">
					<li class="active"><a href="#panel1" data-toggle="tab">普通转帖</a>	</li>
					<li><a href="#panel2" data-toggle="tab">批量转帖</a></li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="panel1">
                    	<form class="form-horizontal" action="" method="POST">
                        	<div class="control-group">
					        	<label class="control-label">URL</label>
					        	<div class="controls">
					            	<input type="text" placeholder="请输入要转帖的URL" class="input-xlarge" id="url" name="url" >
					        	</div>
					    	</div>
					    	
					    	<div class="control-group">
					        	<label class="control-label">标题</label>
					        	<div class="controls">
					            	<input type="text" class="input-xlarge" id="title" name="title" >
					        	</div>
					    	</div>
					    	
					    	<div class="control-group">
					        	<label class="control-label">标签</label>
					        	<div class="controls">
					            	<input type="text" class="input-xlarge" id="tags" name="tags" >
					        	</div>
					    	</div>
					    	
					    	<div class="control-group">
					        	<label class="control-label">描述</label>
					        	<div class="controls">
					            	<textarea type="textarea" class="input-xlarge" id="desc" name="desc" ></textarea>
					        	</div>
					    	</div>
					    
					    	<div class="control-group">
					        	<label class="control-label">优先级</label>
					        	<div class="controls">
					            	<select class="input-xlarge" id="priority" name="priority">
					                	<option value="3">很低</option>
					                	<option value="4">低</option>
					                	<option value="5">中</option>
					                	<option value="6">高</option>
					                	<option value="7">很高</option>
					            	</select>
					        	</div>
					    	</div>
					    	
					    	<div class="control-group">
					        	<label class="control-label">频道</label>
					        	<div class="controls">
					            	<select class="input-xlarge" id="channel" name="channel">
					            		{% for item in classifi_item %}	 
					            			<option value="{{item.0}}">{{item.1}}</option>                   	
				                        {% endfor %}
					            	</select>
					        	</div>
					    	</div>
					    	
					    	<div class="control-group">
					    		<div class="controls" id="tip">{{ tips }}</div>
					    	</div>

					    	<div class="control-group">
                                <input type="text" class="input-xlarge" id="show_id" name="show_id" style="display:none" >
					    	</div>
					    	<div class="control-group">
                                <input type="text" class="input-xlarge" id="site" name="site" style="display:none" >
					    	</div>
					    	
	                        <div class="control-group">
	                        	<div class="controls">
		                            <button id="parse_submit" type="button" class="btn btn-primary" onclick="parse_url();">解析URL</button>
		                            &nbsp;&nbsp;&nbsp;&nbsp;
		                            {% if perms.subscribe.add_repost %}
		                            	<input id="repost_submit" type="submit" class="btn btn-primary" value="提交">
		                            {% else %}
		                            	<input id="repost_submit" type="submit" class="btn btn-primary" disabled="true" value="提交(无权限)">
		                            {% endif %}	
	                        	</div>
	                        </div>
						</form>
					</div>
					
					
					<div class="tab-pane" id="panel2">
						<form class="form-horizontal"  action="batch_repost" method="POST">
							<div class="controls"><h4>最多填写100条链接地址，每行一条链接</h4></div><br/>
							<div class="control-group">
					        	<label class="control-label">优先级</label>
					        	<div class="controls">
					            	<select class="input-xlarge" id="priority" name="priority">
					                	<option value="3">很低</option>
					                	<option value="4">低</option>
					                	<option value="5">中</option>
					                	<option value="6">高</option>
					                	<option value="7">很高</option>
					            	</select>
					        	</div>
					    	</div>
					    	
					    	<div class="control-group">
					        	<label class="control-label">频道</label>
					        	<div class="controls">
					            	<select class="input-xlarge" id="channel" name="channel">
					            		{% for item in classifi_item %}	 
					            			<option value="{{item.0}}">{{item.1}}</option>                   	
				                        {% endfor %}
					            	</select>
					        	</div>
					    	</div>
					    	
					    	<div class="control-group">
					        	<label class="control-label">链接列表</label>
					        	<div class="controls">
					            	<textarea type="textarea" class="input-xlarge" id="links" name="links" rows="10"></textarea>
					        	</div>
					    	</div>
					    	
					    	<div class="control-group">
					    		<div class="controls" id="tip">{{ tips }}</div>
					    	</div>
					    	
	                        <div class="control-group">
	                        	<div class="controls">
		                            <input id="batch_repost_submit" type="submit" class="btn btn-primary" value="提交" >
	                        	</div>
	                        </div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>


{% endblock %}
