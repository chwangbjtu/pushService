<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html class="  ext-strict x-viewport" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>风行UGC系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/libs/twitter-bootstrap/2.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      td a{
         display:inline;white-space:nowrap
        }
    </style>
    <link href="/static/libs/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet">

    <script src="/static/libs/jquery/jquery-1.9.1.min.js"></script>
    <script src="/static/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" >
        thisURL = document.URL;
      var activeLeaf = null;
      $(function(){
          $("li").bind("click",function(event){
            if(this != event.target.parentElement || activeLeaf == this){
              return;
            }
            if(activeLeaf != null){
              activeLeaf.className = "";
            }
            activeLeaf = this;
            this.className = "active";
          })
      })

      //响应视频播放按钮
      function on_btn_play(uri){
        var top = window.screen.availHeight/5;
        var left = window.screen.availWidth/5;
        var width = "1200";
        var height = "600";
        var feature = "width=" + width + ",height=" + height + ",top=" + String(top) + ",left=" + String(left);
        var video_url = "/audit/playvideo?video=" + uri;
        var pop_win = window.open(video_url,"",feature);
        pop_win.focus();
      }
    </script>
    <script>
        function unreg_func()
        {
            var check_boxs = document.getElementsByTagName("input");
            for(var i = 0; i < check_boxs.length; i++)
            {
                var check_box = check_boxs[i];
                if (check_box.id == "tuiding_box")
                {
                    show_content= check_box.name +"value:"+ check_box.value + "checked :"+ check_box.checked;
                    check_box.checked = "true"
                }
            }
        }

        function cancel_func()
        {
            var check_boxs = document.getElementsByTagName("input");
            for(var i = 0; i < check_boxs.length; i++)
            {
                var check_box = check_boxs[i];
                if (check_box.id == "tuiding_box")
                {
                    check_box.checked = "false"
                }
            }
        }

        function resetRows()
        {
            var select_rows = document.getElementsByName("r");
            for(var i = 0; i < select_rows.length; i++){
                var name=select_rows[i].value;
                var tid_array = document.getElementsByName(name);
                for(var j = 0; j < tid_array.length; j++){
                    var item = tid_array[j]
                    if(select_rows[i].checked){
                        item.style.display="";
                    }
                    else{
                        item.style.display="none";
                    }
                }
            }
        }
        function resetRows_modal()
        {
            var select_rows = document.getElementsByName("m");
            for(var i = 0; i < select_rows.length; i++){
                var name=select_rows[i].value;
                var tid_array = document.getElementsByName(name);
                for(var j = 0; j < tid_array.length; j++){
                    var item = tid_array[j]
                    if(select_rows[i].checked){
                        item.style.display="";
                    }
                    else{
                        item.style.display="none";
                    }
                }
            }
            document.getElementById("list_form").submit();
        }
        function pageCheck()
        {
            try {
                var x=document.getElementById("page_go").value;
                if(x=="")    throw "值为空";
                if(isNaN(x)) throw "不是数字";
                if(x>{{ page_count }})     throw "页数太大";
                if(x<1)      throw "页数太小";
            }
            catch(err) {
                var y=document.getElementById("err_doc");
                y.innerHTML="错误：" + err + "。";
                event.returnvalue=false;
                return
            }
            document.getElementById("list_form").submit();
        }
        function change_search_item(content,search_id)
        {
            document.getElementById("search_item").innerHTML=content + " <span class=\"caret\"></span>";
            document.getElementById("search_box").value = search_id
        }

        function change_order_item(content,search_id)
        {
            document.getElementById("order_item").innerHTML=content + " <span class=\"caret\"></span>";
            document.getElementById("order_box").value = search_id
        }
    </script>
</head>
<body id="ext-gen3" class="body_class" scroll="no" style="width:100%;height:100%;margin:0 auto;">
    <h1 class="text-center">UGC审核系统</h1>
    <form id='list_form' action="" method="GET">
    <div class="container">
        <table>
            <tr>
                <td class="span6">
                    <div>
                        <div class="btn-group">
                            <a class="btn dropdown-toggle" id="search_item"data-toggle="dropdown" href="#">
                                {% if page_info.search_value %}
                                    {{ page_info.search_value}}
                                {% else %}
                                    标题
                                {% endif %}
                                <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
                                {% if page_info.search_dic %}
                                    {% for key,value in page_info.search_list %}
                                        <li><a tabindex="-1" href="javascript:change_search_item('{{ value }}', '{{ key }}')">{{ value }}</a></li>
                                    {% endfor%}
                                {% else %}
                                        <li><a tabindex="-1" href="javascript:change_search_item('视频ID', 'tid')">视频ID</a></li>
                                        <li><a tabindex="-1" href="javascript:change_search_item('vid', 'vid')">vid</a></li>
                                        <li><a tabindex="-1" href="javascript:change_search_item('标题', 'title')">标题</a></li>
                                        <li><a tabindex="-1" href="javascript:change_search_item('标签', 'tags')">标签</a></li>
                                {% endif %}

                            </ul>
                        </div>
                    {% if page_info.search %}
                        <input class="text" id='search_box' style="display:none" name="search" value={{page_info.search}}></input>
                    {% else %}
                        <input class="text" id='search_box' style="display:none" name="search" value="title"></input>
                    {% endif %}
                        <input class="text" id='search_content' name="search_content" value="{{ page_info.search_content }}"></input>
                        <div class="btn-group">
                            <a class="btn dropdown-toggle" id="order_item"data-toggle="dropdown" href="#">
                                {% if page_info.order_value %}
                                    {{ page_info.order_value}}
                                {% else %}
                                    按间
                                {% endif %}
                                <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
                                {% if page_info.order_dic%}
                                    {% for key,value in page_info.order_list %}
                                        <li><a tabindex="-1" href="javascript:change_order_item('{{ value }}', '{{ key }}')">{{ value }}</a></li>
                                    {% endfor%}
                                {% else %}
                                        <li><a tabindex="-1" href="javascript:change_order_item('按时间', 'time')">按时间</a></li>
                                        <li><a tabindex="-1" href="javascript:change_order_item('按时间 逆序', 'time desc')">按时间 逆序</a></li>
                                        <li><a tabindex="-1" href="javascript:change_order_item('按视频ID', 'tid')">按视频ID</a></li>
                                        <li><a tabindex="-1" href="javascript:change_order_item('按视频ID 逆序', 'tid desc')">按视频ID 逆序</a></li>
                                {% endif %}
                            </ul>
                        </div>
                    {% if page_info.order%}
                        <input class="text" id='order_box' style="display:none" name="order" value={{page_info.order}}></input>
                    {% else %}
                        <input class="text" id='order_box' style="display:none" name="order" value="time"></input>
                    {% endif %}

                        <button id="page_subit" type="submit" class="btn btn-primary">搜索</button>
                        <div class="btn-group">
                    </div>
                </td>
                <td class="span4">
                    <form name="form2" method="post" action="">
                        <div>
                            <a href="#myModal" role="button" class="btn btn-info" data-toggle="modal">定制表单</a>
                            <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                                    <h3 id="myModalLabel">定制表单</h3>
                                </div>
                                <div class="modal-body">
                                    <ul>
                                    {% if page_info.cols %}
                                        {% for col,col_value in page_info.cols_real %}
                                            {% if col in page_info.cols %}
                                                {% if col == "tuiding_col" %}
                                                    {% if unreg %}
                                                        <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" checked />{{ col_value }}</a> </li>
                                                    {% endif %}
                                                {% elif  col == "username_col" %}
                                                    {% if unreg %}
                                                        <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" checked />{{ col_value }}</a> </li>
                                                    {% endif %}
                                                {% else %}
                                                        <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" checked />{{ col_value }}</a> </li>
                                                {% endif %}
                                            {% else %}
                                                {% if col == "tuiding_col" %}
                                                    {% if unreg %}
                                                        <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" />{{ col_value }}</a> </li>
                                                    {% endif %}
                                                {% elif  col == "username_col" %}
                                                        {% if audit %}
                                                            <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" checked />{{ col_value }}</a> </li>
                                                        {% endif %}
                                                {% else %}
                                                        <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" />{{ col_value }}</a> </li>
                                                {% endif %}

                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        {% if page_info.cols_real %}

                                            {% for col,col_value in page_info.cols_real %}
                                                    {% if col == "tuiding_col" %}
                                                        {% if unreg %}
                                                            <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" checked />{{ col_value }}</a> </li>
                                                        {% endif %}
                                                    {% elif  col == "username_col" %}
                                                        {% if audit %}
                                                            <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" checked />{{ col_value }}</a> </li>
                                                        {% endif %}
                                                    {% else %}
                                                            <li> <a href="#"> <input type="checkbox" name="m" value="{{ col }}" checked />{{ col_value }}</a> </li>
                                                    {% endif %}
                                            {% endfor %}

                                        {% else %}
                                                {% if unreg %}
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="tuding_col" checked />退订</a> </li>
                                                {% endif %}
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="tid_col" checked />视频ID</a> </li>
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="title_col" checked />标题</a> </li>
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="tags_col" checked />标签</a> </li>
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="user_col" checked />上传用户</a> </li>
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="duration_col" checked />时长</a> </li>
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="playtimes_col" checked />播放量</a> </li>
                                                {% if audit %}
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="username_col" checked />审核用户</a> </li>
                                                {% endif %}
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="time_col" checked />审核时间</a> </li>
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="vid_col" checked />vid</a> </li>
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="priority_col" checked />优先级</a> </li>
                                                    <li> <a href="#"> <input type="checkbox" name="m" value="action_col" checked />操作</a> </li>
                                        {% endif %}

                                    {% endif %}
                                    </ul>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn" data-dismiss="modal" aria-hidden="true" onclick="resetRows_modal()">关闭</button>
                                    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true" onclick="resetRows_modal()">确定</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </td>
            </tr>
        </table>
    </div>
    <div class="container">
        <form action="" method="POST">
            <fieldset>
            <table class="table table-striped table-bordered table-hover table-condensed" width="70%">
                <thead>
                    <tr id="liebiao" width="70%">
                        {% if page_info.cols_real and page_info.cols %}
                            {% for col,col_value in page_info.cols_real %}
                                {% if col in page_info.cols %}
                                    {% if col == "tuiding_col" %}
                                        {% if unreg %}
                                            <td id="unreg_btn"  name='unreg_col' class="btn-primary" onclick="unreg_func()" width="12%">全选</td>
                                        {% endif %}
                                    {% elif  col == "username_col" %}
                                            {% if admin_audit %}
                                                <td name='{{ col }}'> {{ col_value }} </td>
                                            {% endif %}
                                    {% else %}
                                                <td name='{{ col }}'> {{ col_value }} </td>
                                    {% endif %}
                                {% else %}
                                    {% if col == "tuiding_col" %}
                                        {% if unreg %}
                                                <td name='{{ col }}' style="display:none"> {{ col_value }} </td>
                                        {% endif %}
                                    {% elif  col == "username_col" %}
                                            {% if admin_audit %}
                                                <td name='{{ col }}' style="display:none"> {{ col_value }} </td>
                                            {% endif %}
                                    {% else %}
                                                <td name='{{ col }}' style="display:none"> {{ col_value }} </td>
                                    {% endif %}

                                {% endif %}
                            {% endfor %}
                        {% else %}
                            {% if unreg %}
                                    <td id="unreg_btn" name='unreg_col' class="btn-primary" onclick="unreg_func()" width="10%">全选</td>
                            {% endif %}

                            <td name='tid_col' width="10%">视频ID</td>
                            <td name='uid_col' width="10%">用户ID</td>
                            <td name='title_col' width="20%">标题</td>
                            <td name='tags_col' width="25%">标签</td>
                            <td name='channel_col' width="10%">频道</td>
<!--
                            <td name='funshion_id_col'>风行ID</td>
                            <td name='user_col'>上传用户</td>
                            <td name='duration_col'>时长</td>
                            <td name='playtimes_col'>播放量</td>
                            {% if admin_audit %}
                                <td name='username_col'>审核用户</td>
                            {% endif %}
                            <td name='time_col'>审核时间</td>
                            <td name='vid_col'>vid</td>
-->
                            <td name='priority_col' width="10%">优先级</td>
                            <td name='action_col'  width="5%">操作</td>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                {% if page_info.cols %}
                    {% for data in data_list %}
                    <tr>
                            {% if unreg %}
                                {% if 'tuiding_col' in page_info.cols %}
                                <td name='tuiding_col'> <input id="tuiding_box" type="checkbox" name={{data.tid}}> </td>
                                {% else %}
                                <td name='tuiding_col' style="display:none"> <input type="checkbox" name={{data.tid}}> </td>
                                {% endif %}
                            {% endif %}

                            {% if 'tid_col' in page_info.cols %}
                            <td name='tid_col'>{{data.tid}}</td>
                            {% else %}
                            <td name='tid_col' style="display:none">{{data.tid}}</td>
                            {% endif %}

                            {% if 'uid_col' in page_info.cols %}
                            <td name='uid_col'>{{data.uid}}</td>
                            {% else %}
                            <td name='uid_col' style="display:none">{{data.uid}}</td>
                            {% endif %}

                            {% if 'title_col' in page_info.cols %}
                            <td name='title_col'>{{data.title}}</td>
                            {% else %}
                            <td name='title_col' style="display:none">{{data.title}}</td>
                            {% endif %}

                            {% if 'tags_col' in page_info.cols %}
                            <td name='tags_col'>{{data.tags}}</td>
                            {% else %}
                            <td name='tags_col' style="display:none">{{data.tags}}</td>
                            {% endif %}
                            
                            {% if 'channel_col' in page_info.cols %}
                            <td name='channel_col'>{{data.channel}}</td>
                            {% else %}
                            <td name='channel_col' style="display:none">{{data.channel}}</td>
                            {% endif %}
<!--
                            {% if 'funshion_id_col' in page_info.cols %}
                            <td name='funshion_id_col'>{{data.funshion_id}}</td>
                            {% else %}
                            <td name='funshion_id_col' style="display:none">{{data.funshion_id}}</td>
                            {% endif %}

                            {% if 'user_col' in page_info.cols %}
                            <td name='user_col'>{{data.user}}</td>
                            {% else %}
                            <td name='user_col' style="display:none">{{data.user}}</td>
                            {% endif %}


                            {% if 'duration_col' in page_info.cols %}
                            <td name='duration_col'>{{data.duration}}</td>
                            {% else %}
                            <td name='duration_col' style="display:none">{{data.duration}}</td>
                            {% endif %}

                            {% if 'playtimes_col' in page_info.cols %}
                            <td name='playtimes_col'>{{data.playtimes}}</td>
                            {% else %}
                            <td name='playtimes_col' style="display:none">{{data.playtimes}}</td>
                            {% endif %}
                            {% if admin_audit %}
                                {% if 'username_col' in page_info.cols %}
                                <td name='username_col'>{{data.username}}</td>
                                {% else %}
                                <td name='username_col' style="display:none">{{data.username}}</td>
                                {% endif %}
                            {% endif %}
                            
                            {% if 'time_col' in page_info.cols %}
                            <td name='time_col'>{{data.time}}</td>
                            {% else %}
                            <td name='time_col' style="display:none">{{data.time}}</td>
                            {% endif %}

                            {% if 'vid_col' in page_info.cols %}
                            <td name='vid_col'>{{data.vid}}</td>
                            {% else %}
                            <td name='vid_col' style="display:none">{{data.vid}}</td>
                            {% endif %}
-->
                            {% if 'priority_col' in page_info.cols %}
                            <td name='priority_col'>{{data.priority}}</td>
                            {% else %}
                            <td name='priority_col' style="display:none">{{data.priority}}</td>
                            {% endif %}

                            {% if 'action_col' in page_info.cols %}
                            <td name='action_col'> <a class="btn btn-primary" href="/audit/showvideo?tid={{ data.tid }}{{ admin_audit}}" >查看</a> </td>
                            {% else %}
                            <td name='action_col' style="display:none"> <a class="btn btn-primary" href="/audit/showvideo?tid={{ data.tid }}{{ admin_audit}}" >查看</a> </td>
                            {% endif %}
                    </tr>
                    {% endfor%}
                    {% else %}
                        {% for data in data_list %}
                        <tr>
                                {% if unreg %}
                                    <td name='tuiding_col'> <input id="tuiding_box" type="checkbox" name={{data.tid}}> </td>
                                {% endif %}
                                <td name='tid_col'>{{data.tid}}</td>
                                <td name='uid_col'>{{data.uid}}</td>
                                <td name='title_col'>{{data.title}}</td>
                                <td name='tags_col'>{{data.tags}}</td>
                                <td name='channel_col'>{{data.channel}}</td>
<!--
                                <td name='funshion_id_col'>{{data.funshion_id}}</td>
                                <td name='user_col'>{{data.user}}</td>
                                <td name='duration_col'>{{data.duration}}</td>
                                <td name='playtimes_col'>{{data.playtimes}}</td>
                                {% if admin_audit %}
                                    <td name='username_col'>{{data.username}}</td>
                                {% endif %}
                                <td name='time_col'>{{data.time}}</td>
                                <td name='vid_col'>{{data.vid}}</td>
-->
                                <td name='priority_col'>{{data.priority}}</td>
                                <td name='action_col'> <a class="btn btn-primary" href="/audit/showvideo?tid={{ data.tid }}{{ admin_audit}}" >查看</a> </td>
                        </tr>
                        {% endfor%}

                    {% endif %}
                </tbody>
            </table>
            {% if unreg %}
            <button id="tuiding_subit" type="submit" class="btn btn-primary">退订</button>
            {% endif %}
        </fieldset>
        </form>

        <table class="table">
            <tbody>
                <tr>
                    <td> 本页共{{list_count}}条 </td>
                    <td> 所有记录共{{record_count}}条 </td>
                    <td>共{{page_count}}页 </td>
                    <td>
                        <div>
                                    第
                                    <input class="text span1" id="page_go" name="page" value={{page_number}} placeholder="     几" onkeypress="if(event.keyCode==13||event.which==13){return pageCheck()}">
                                    页
                                    <input id="page_subit" type="button" value="转到" class="btn btn-primary" onclick="pageCheck()"></input>
                                    <p id="err_doc"></p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="pagination pagination-large">
            <ul>
                {% if page_number > 1%}
                    <li> <a href="?page=1{{page_info.request_args}}">&lt;&lt;</a> </li>
                {% else %}
                <li class="disabled"><a>&lt;&lt;</a> </li>
                {% endif %}
                {% if page_number > 1%}
                    <li><a href="?page={{ page_number_last }}{{page_info.request_args}}">&lt;</a></li>
                {% else %}
                    <li class="disabled"><a>&lt;</a> </li>
                {% endif %}
                {% for pg in page_range %}
                    {% if pg == page_number %}
                    <li><a class="btn btn-success" href="?page={{ pg }}{{page_info.request_args}}">{{pg}}</a></li>
                    {% else %}
                    <li><a href="?page={{ pg }}{{page_info.request_args}}">{{pg}}</a></li>
                    {% endif %}
                {% endfor %}
                {% if page_number < page_count %}
                    <li><a href="?page={{ page_number_next }}{{page_info.request_args}}">&gt;</a></li>
                {% else %}
                    <li class="disabled"><a>&gt;</a></li>
                {% endif %}
                {% if page_number < page_count %}
                    <li><a href="?page={{ page_count }}{{page_info.request_args}}">&gt;&gt;</a></li>
                {% else %}
                    <li class="disabled"><a>&gt;&gt;</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
    </form>
</body>
</html>
